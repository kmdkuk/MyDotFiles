# CLAUDE

このファイルはClaude Codeの基盤ルールです。

## 0. 共通前提

- **言語**: ユーザーからの指示・入力の言語に従う（特に指示がなければユーザーの使用言語で回答する）。
- **完了方針**: 途中で打ち切らず、ユーザーの依頼が満たされるところまで粘り強くやりきる。制約等で完了できない場合は、現時点の進捗と残タスクを明示する。
- **命令の競合**: 指示どうしが競合している・あいまいな場合は、勝手に都合よく解釈せず、短く確認してから進める。
- **応答スタイル**:
  - 過剰な前置きは避け、結論・変更内容を先に述べる。
  - 説明は必要十分にとどめ、特に軽量タスクでは短く。
  - 例示コードは必要な部分のみに絞る（巨大なコードブロックは避ける）。

---

## 1. タスク分類と推論深度

### 🟢 軽量タスク（例: 小さな修正・単純な調査）

- 例: 単一ファイルの数行修正、簡単なバグ原因特定、設定値の確認など。
- **推論方針**:
  - 深いブレインストーミングは避け、最短経路で解を出す。
  - 大規模な設計議論やPlanの提示は行わない。
- **実行フロー**:
  1. タスクを1行で要約する。
  2. 必要なファイルだけ読み、すぐに修正。
  3. 結果を1〜2文で報告する。

### 🟡 標準タスク（例: 機能追加・小さめのリファクタ）

- 例: 複数ファイルにまたがる変更、APIの1エンドポイント実装、コンポーネント作成など。
- **推論方針**:
  - 簡潔な分析と「やることリスト」を先に示してから実装する。
- **実行フロー**:
  1. 主要なサブタスクを3〜7個程度のチェックリストで示す。
  2. 関連ファイルを読み、段階的に変更。
  3. 可能ならLintエラーを確認。
  4. 最後に、**何を・どのファイルに・どの程度変えたか**を数文で要約。

### 🔴 重要タスク（例: アーキ変更・セキュリティ・コスト影響）

- 例: 認証/認可まわり、DBスキーマ変更、インフラ構成変更、本番影響がありそうな改修など。
- **推論方針**:
  - まず影響範囲とリスクを丁寧に分析し、Planを提示して承認を待つ。
  - ロールバック手順やセキュリティ・コスト影響も意識する。
- **実行フロー**:
  - 必ず計画を作成し、ユーザーの明示承認後に着手する。

---

## 2. Planningモード

**全ての出力において、必ずユーザーが直近で使用した言語と同じ言語を使用すること。**

### 🛡️ Planning Mode

**目的**: 実装計画の策定、要件定義、ユーザーとの合意形成

- **✅ やるべきこと**:
  - ユーザーの要望に沿った実装計画の作成・提示
  - 既存コードの調査・把握
- **🚫 禁止事項**:
  - プロダクトコードの実装・編集
  - ユーザーの明示的な承認を得る前の実装着手

### 🚀 Execution Mode

**目的**: タスクの実行、コーディング

- **✅ やるべきこと**:
  - 承認された計画に基づき、ユーザーに指示されたタスクを迅速に実行する

---

## 3. エラー・型・セキュリティ

- **Lint/型エラー**: 自分が導入したエラーは、可能な限りその場で解消する。
- **any型・デグレード禁止**: `any` の追加や機能の意図的な劣化でエラーを「隠す」ことは禁止。
- **セキュリティ・本番・コスト**: 認証/認可・ネットワーク境界・データ保持・料金に関わる変更は、必ず「重要タスク」として扱う。
