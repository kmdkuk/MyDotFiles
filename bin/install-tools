#!/usr/bin/env bash

set -eu

function check_command() {
  if command -v $1 > /dev/null 2>&1; then
    return 0
  fi
  return 1
}


if [ "$(uname)" == 'Darwin' ]; then
  if [ -z "$(command -v brew)" ]; then
    : "--- Install Homebrew is Start! ---"
    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
    : "--- Install Homebrew is Done!  ---"
  fi
  brew bundle --global || true
elif [ "$(expr substr $(uname -s) 1 5)" == 'Linux' ]; then
  # Managed by brew on macOS
  # Managed by aqua
  if ! check_command aqua; then
    echo "aqua is not found. Install aqua..."
    # https://aquaproj.github.io/docs/products/aqua-installer#shell-script
    curl -sSfL -O https://raw.githubusercontent.com/aquaproj/aqua-installer/v4.0.4/aqua-installer
    echo "acd21cbb06609dd9a701b0032ba4c21fa37b0e3b5cc4c9d721cc02f25ea33a28  aqua-installer" | sha256sum -c -
    chmod +x aqua-installer
    ./aqua-installer
    rm aqua-installer
  fi
  export PATH="${AQUA_ROOT_DIR:-${XDG_DATA_HOME:-$HOME/.local/share}/aquaproj-aqua}/bin:$PATH"
  export AQUA_GLOBAL_CONFIG=${XDG_CONFIG_HOME:-$HOME/.config}/aquaproj-aqua/aqua.yaml
  echo "Install tools by aqua..."
  aqua i -l -a
fi
